---
title: "IPrism"
author: "Rogia Kpanou"
date: "10 August, 2017"
output: 
    html_document:
       toc: true
       toc_float:
         collapsed: false
         smooth_scroll: false
       number_sections: true
       theme: cerulean
       highlight: pygments
---



### Running Prism 

To run Prism, do:

+ **Step 1:(optional)**

If you are not sure that your file contains fewer contigs, please use the separator.py script. This script will separate your file into    subfiles Of less than 1000 contigs. A sample command line run might look like: 
  
```r
  $ python separator.py  inputfile
```
  To execute it on a whole directory, it would be necessary to use a loop:
```r
  $ for i in $(ls directory); do python separator.py $i ; done
```
   
+ **Step 2: Generate job Submission Files to Colosse.**
    - source : Folder in which the fasta files are
    - destination: Folder where scripts should be written 
    
Use for this purpose the colosse.py script:
```r
    $python colosse.py source destination
```
+ **Step 3:** 
 
The prism results are in directory prism wrote in /rap/nne-790-ab/software2/prism-releases-master/prism/WebContent.

### IPrism

For the interpretation and representation of the prism results

#### USAGE

+ **Step 1: Produce a cdhit file that respects the format and that takes into account all the organisms**

Two options offer here to you :

  1. Run prodigal on your all genomes to generate the .pep files that will be used in cd-hit
  
    (See the tutorial of the former trainee to manually generate the protein file)
    
  2. Use prodigal files generated by prism (recommanded). How to proceed? Use the 2xpr.py script:
    
```r
$ python 2xpr.py PRISMRESULTFOLDER/
```
  It performs the following actions:
  
  a. For each file of proteins, it adds to the head of the sequence the name of the SAMPLE
  b. It concatenates the files of proteins whose headers of sequences are now modified to generate a file cat_prodigal.fasta to be used for the cdhit
    
+ **Step 2: Command line**

A sample command line run might look like: 

```r
$ python IPrism.py -S les_3.xlsx -c /home/rogia/FR_genome/Data/cdhit/20170707_OrthologComparison_Nares+Modern_Nostoc+GCF_20025-70.clstr -a attr.xlsx /home/rogia/FR_genome/mini_data
```

To see a detailed description of all command line options, do:

```r
$ python IPrism.py -h


usage = """IPrism For the interpretation and representation of the prism results.

Usage:
  IPrism.py [options] <inputfolder>


Options:
  -h --help     Show this screen
  --version     Version 0.0
  -S XLSXFILE1 --table XLSXFILE1    Name of Statistical table(output)
  -c CLSTRFILE --chr CLSTRFILE     cd-hit results file
  -a XLSXFILE2 --attr XLSXFILE2    Name of the attributes file. This file is used for cytoscape.(output)
"""
```


+ **Step 3: Create the graph with cytoscape**
    
Here you will need two files: the one generated by clusterGraph and the file of attributes from IPrism


#### REQUIEREMENTS
+ Python 2.7
+ json
+ numpy 
+ glob
+ xlwt 
+ os
+ lxml 
+ collections
+ docopt
+ cytoscape
+ clustergraph
+ excel
+ xlrd

A virtual environment containing all these python packages has been created. It can be found here:
/lustre4/CHUdeQuebec/nne-790-ad/projects/ENV

How to use thi virtual environment?
1. Load python
2. run `source ENV/bin/activate`
3. to desactivate it, run `deactivate`

#### FILES DESCRIPTION
The directory contains three files:

1. IPrism.py : It' s the main file.
2. p_file.py : Contains functions used to perform previous actions
3. 2xpr.py : Concatenate the protein files of all genomes into a single protein file. In this new file, 
         all the sequences are identified by the name of the sample.

#### OUTPUT DESCRIPTION
The files  obtained at the output are excel files:

1. The first pecified py -S option: Contains The number of clusters of each type per genome
2. The another one specified by -a option : It' s attributes file.

